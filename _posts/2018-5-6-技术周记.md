---
layout: post
title: 技术周记
date: 2018-5-6
tags: 周记
---

### 记录
  最近一周时间，大部分工作时间加班时间都献给了公司里面的事。生产项目临时加了紧急需求，要尽快完成，虽然时间计划订的是下周五之前但实际上项目经理的意思是越快越好，因此耗费了极大的时间。另一部分，就是公司内部OA的测试问题，测试搞出了很多幺蛾子。我有时候不太明白，为什么都不愿意多试一次，哪怕多试一次就不用在群里唧唧歪歪叫我解决问题了，因为那种偶然性的问题产生的可能性很多，又没办法复现给我，我怎么去解决呢。
  哦对了，因为导师离职的关系，工作交接还参加了乱七八糟的会议。这些会议的目的是工作交接，交接内容包含代码的架构和设计思想和文档，然而，参加会议交接工作的效率大概三成多。因为前期开发过程几乎没参与，甚至在很久之前为了让更多人了解这一块内容而开会讨论都没注意听，导致现在工作交接效率低。当然，这也跟任务的分配有一定关系，如果当初任务被拆解为一个个小的功能块大家一起参与开发，可能现在要好很多。
  前几天，支持测试修改了一个数据源错误的问题,错误原因是EL表达式书写问题。EL表达式里面完成加减乘数、逻辑运算都应该注意空格、等号、引号、双引号等，这些多写或者多用都会产生意料之外的结果，值得注意。
  周五逛微博的时候看到一个关于Java技术专栏的付费内容，当时只是标记了，没有注意，昨天看了一下还不错，冲动之下进行付费购买，也算是第一次为知识付费，希望能有用。因为那个专栏的开篇词写到我心里去了，工作两年以来，所学所用的知识确实没有形成一个体系，很难说自己在技术方面有什么积累，不过是一些经验之谈，完全没有内化成自己的知识。希望后面能跟着那个专栏好好去回溯一些自己学过的内容，形成一种积累而不是只会用。
  周末两天在做CAS的技术积累，虽然生产上加了莫名其妙的紧急需求，但是项目组这一次的CAS开发我也想参与其中，这个技术学到就是赚到，以后出去面试是可以吹牛逼的。

### 最近遇到的一些问题
#### 开发时遇到的问题
##### EL表达式失效导致前端数据源展示问题
  我debug到后台发现从数据库乃至到web层的数据都是正常的，前端显示不正确，查看jsp中发现EL表达式使用的==逻辑运算，但是在值后面多了一个空格，删掉，问题解决。一搜索，网上同类问题挺多的，使用EL表达式应该注意这个问题。

#### spring-boot
##### spring-boot执行打包 `mvn clean packagee`，将其放入Tomcat容器下，启动服务器，没有报错，但是也没办法去访问该项目；
 【尚未解决】
##### 无进展，仍在计划列表中；
 【尚未解决】 
#### JVM调优，主要针对公司内部OA总是宕机问题；
 【尚未解决】本周无进展，仍在计划列表中；
#### CAS技术储备；
  【进行中】这个周末终于开始了CAS的技术储备。
  - 看完了Apereo的quick start, 初识其架构，以及一些其他现在已经想不起来的内容，全英文的，边看边翻译，看起来略吃力，所以现在已经不太能回忆起它究竟讲了些啥。貌似有服务器和客户端的区别、协议之类的。
  - 跟着网上一个大佬的系列文章完成了Hello项目的搭建；
  - 完成了配置中心的搭建，并能够成功运行；
  - 配置了HTTPS；
  - 完成了JDBC的配置，并替换了静态用户。配置了盐值加密，并将加密的密码配置到数据库中进行测试，成功；
  - 勉强学会了在debug模式下启动spring-boot的项目，并进行了调试，目前是OK的。
  - 有两个类值得关注，当用户未配置密码加密时，使用的DefaultPasswordEncoder,配置了盐值加密后使用的是NoOpPasswordEncoder，这两个类皆继承自PasswordEncoder接口，该接口中有两个方法，encode()和matches()，这两个方法完成了登录认证中的核心部分，密码加密工作以及和数据库中查询出的密码加密后原文进行对比，这里决定了整个登录过程是否成功。当这里完成过后才会在QueryAndEncodeDatabaseAuthenticationHandler中对expired字段和disable字段先后进行校验，如果这里过时或者账号被禁用，同样意味着登录失败；
  - 我感觉上面一段并没有讲清楚我最近两天理解出来的内容,在下面写一下调用关系吧。

```
QueryDatabaseAuthenticationHandler的实例的调用父类AbstractPreAndPostProcessingAuthenticationHandler中的authenticate()方法，该方法中调用 doAuthentication()方法，这里面完成了：
①创建含用户输入的用户名和密码的凭据；
②对用户名和密码进行空判断校验和转换；
③使用PasswordEncoder的实例调用encode()方法对密码进行加密（这里的PasswordEncoder实例取决于是否配置了盐值加密，如果没有则使用DefaultPasswordEncoder，如果使用了盐值加密则使用NoOpPasswordEncoder）；
④使用QueryDatabaseAuthenticationHandler中实现的authenticateUsernamePasswordInternal()方法去完成数据库原始用户数据的查询工作，并在这里面调用PasswordEncoder的matches()方法进行密码比对，同时校验expired字段和disable字段；
⑤完成校验工作，创建一个处理结果并返回。

```

### 下一个阶段
  明天继续做生产吧。要抽出时间来捋一捋CAS中的校验过程，把类的调用搞关系捋清楚，后面切入业务的时候才更好入手。此外，之前买的专栏不能放弃，每周更新两篇都要看完做笔记，不然浪费48块钱，肉痛。