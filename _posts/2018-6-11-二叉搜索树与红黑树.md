---
layout: post
title: 二叉搜索树与红黑树
date: 2018-06-11
tags: 算法
---

### 二叉搜索树(Binary Search Tree)
- 有序数组可以快速的寻找的一个值。但是如果想插入就得找到待插入的数据的位置，然后将其后的所有数据往后挪一个位置，再插入。同样如果打算删除也是如此，找到待删除的数据，删除后，再将其后的数据依次往前挪一个位置。因此，如果有频繁的插入删除操作，选用有序数组显然效率太低。

- 链表可以快速的插入数据，删除数据，只需要将其前后的节点重新指向即可，但是如果打算在链表中查找数据，则不得不依次遍历所有数据，必须从链表头开始访问每一个数据项，直到找到数据为止。

- 树形结构是数组和链表的一个折中方案，既可以像数组那样实现快速的搜索，又能像链表那样快速的插入和删除。其中二叉搜索树就是最常见的树形结构。

- 使用二叉搜索树插入数据需要保证数据的无序性，因为数据一旦有序以后，插入到树形结构中的数据将形成一个链表结构，无法发挥二叉搜索树应有的性能。

- 二叉搜索树有以下特性:
	- 节点的左子节点的数据项小于这个节点数据项
	- 右子节点的数据项大于或等于这个节点数据项
	- 插入一个节点需要根据前面的两个规则进行插入

- 删除操作
	- 待删除节点n没有子节点
		- 找到待删除节点p的父节点np
		- 将np的左子节点或右子节点的引用指向null（剩下的交给gc）
	- 待删除节点n有一个子节点
		- 找到待删除节点n的父节点np
		- 找到待删除节点n的左子节点或右子节点nc
		- 将np的左子节点或右子节点指向nc
		- 将nc的父节点指向np
	- 待删除节点n有两个子节点
		- 寻找待删除节点n的继承者ns
			- 基本思路就是，沿着（待删除节点的右子节点nr -> nr的左子节点nrl -> nrl的左子节点nrll -> ...）路径一路搜索，直到没有左子节点为止
		- 继承节点ns按照上一步的搜索方式寻找出来，则会有两种可能性:
			- ns没有子节点（将ns直接取出，插入到待删除的节点处）
				- 找到ns的父节点，将其左子节点置为null(此时ns被从父节点中切割出来)
				- 获取n节点的父节点np，左子节点nl，右子节点nr
				- 将ns的父节点指向np，左子节点指向nl，右子节点指向nr
				- 将np的左子节点或右子节点指向ns，将nl的父节点指向ns，将nr的父节点指向ns
			- ns有右子节点(分两步走:取出ns,将ns插入到n的位置)
				- 找到ns的父节点nsp，找到ns的右子节点nsr
				- 将nsp的左子节点指向nsr，将nsr的父节点指向nsp(此时ns被从父节点和子节点中切割出来)
				- 获取n节点的父节点np，左子节点nl，右子节点nr
				- 将ns的父节点指向np，左子节点指向nl，右子节点指向nr
				- 将np的左子节点或右子节点指向ns，将nl的父节点指向ns，将nr的父节点指向ns

- 插入操作（插入操作应当保证没有数据项相等的元素）
	- 待插入的节点p的数据项小于根节点r
		- 转向左子节点
		- 如果左子节点为null，则直接插入
		- 如果左子节点不为null，则以左子节点为根节点继续比较
	- 待插入的节点p的数据项大于等于根节点r
		- 转向右子节点
		- 如果右子节点为null，则直接插入
		- 如果右子节点不为null，则以右子节点为根节点继续比较

- 搜索操作
	- 从根节点开始遍历，判断搜索的数据项数据与根节点数据的大小
	- 如果小于根节点数据项，则转向左子节点，判断左子节点是否为存在
		- 不存在就搜索失败
		- 存在，则以左子节点为根节点继续搜索
	- 如果大于根节点数据项，则转向右子节点，判断右子节点是否为存在
		- 不存在就搜索失败
		- 存在，则以右子节点为根节点继续搜索
	- 如果等于根节点数据项，则返回根节点的内容


### 自平衡二叉查找树(AVL)
- 在AVL树中任何节点的两个子树的高度最大差别为一，所以它也被称为高度平衡树。

- 查找、插入和删除在平均和最坏情况下都是O(log n)，增加和删除可能需要通过一次或多次树旋转来重新平衡这个树。

- AVL树得名于它的发明者 G.M. Adelson-Velsky 和 E.M. Landis

- AVL树本质上是带了平衡功能的二叉查找树（二叉排序树，二叉搜索树），它的特点是：
	- 本身首先是一棵二叉搜索树，满足以下条件:
		- 节点的左子节点的数据项小于这个节点数据项
        - 右子节点的数据项大于或等于这个节点数据项
        - 插入一个节点需要根据前面的两个规则进行插入
	- 带有平衡条件：每个结点的左右子树的高度之差的绝对值（平衡因子）最多为1

- AVL树的节点计算
	- 高度为 h 的 AVL 树，节点数 N 最多2^h − 1； 最少N(h)=N(h− 1) +N(h− 2) + 1。其中，N(0) = 1 (表示 AVL Tree 高度为0的节点总数），N(1) = 2（表示 AVL Tree 高度为1的节点总数），N(2) = 4（表示 AVL Tree 高度为2的节点总数）。

- 旋转(假设，存在节点a，其父节点为p)
	- 失去平衡的节点为a，它的左子树为b，b被插入了左子节点c，形成左左结构。此时，需要将a向右移动为b的右子节点而b与p相连，p的子树b重新达到平衡。这就是单向右旋平衡处理LL。
	[单向右旋平衡处理](单向右旋平衡处理LL.jpg)
	- 失去平衡的节点为a，它的右子树为b，b被插入了右子节点c，形成右右结构。此时，需要将a向左移动为b的左子节点而b与p相连，p的子树b重新达到平衡。这就是单向左旋平衡处理RR。
	[单向左旋平衡处理](单向左旋平衡处理RR.jpg)
	- 失去平衡的节点为a，它的左子树为b，b被插入了右子节点c，形成左右结构。此时，需要将c向左移动为a的左子节点，而b作为c的左子节点，形成左左结构，再进行步骤一的单向右旋平衡处理，即可达到平衡。双向旋转（先左后右）平衡处理LR。
	[双向旋转（先左后右）平衡处理](双向旋转_先左后右_平衡处理LR.jpg)
	- 失去平衡的节点为a，它的右子树为b，b被插入了左子节点c，形成右左结构。此时，需要将c向右移动为a的右子节点，而b作为c的右子节点，形成右右结构，再进行步骤二的单向左旋平衡处理，即可达到平衡。双向旋转（先右后左）平衡处理RL。
	[双向旋转（先右后左）平衡处理](双向旋转_先右后左_平衡处理RL.jpg)

- 插入(BBST: Balanced Binary Search Tree)
	- 若BBST为空树，则插入一个数据元素为e的新结点作为BBST的根结点
    - 若e的关键字和BBST的结点的关键字相等，则不进行任何操作
    - 若e的关键字小于BBST的结点的关键字，而且在BBST的左子树中不存在和e有相同关键字的结点，则将e插入在BBST的左子树上，分不同情况处理：
    	- 如果插入节点为左子节点
            - 如果BBST的左子树的高度大于右子树，形成左左结构，需要一次单向右平衡处理
            - 如果BBST的左右子树高度相等，插入完成
            - 如果BBST的左子树的高度小于右子树，插入完成
		- 如果插入节点为右子节点
			- 如果BBST的左子树的高度大于右子树，形成左右结构，需要双向先转，先左再右
            - 如果BBST的左右子树高度相等，插入完成
            - 如果BBST的左子树的高度小于右子树，插入完成
    - 若e的关键字大于BBST的结点的关键字，而且在BBST的右子树中不存在和e有相同关键字的结点，则将e插入在BBST的右子树上，分不同情况处理：
    	- 如果插入节点为左子节点
            - 如果BBST的左子树的高度大于右子树，形成右左结构，需要双向旋转，先右再左
            - 如果BBST的左右子树高度相等，插入完成
            - 如果BBST的左子树的高度小于右子树，插入完成
		- 如果插入节点为右子节点
			- 如果BBST的左子树的高度大于右子树，形成右右结构，需要一次单向左平衡处理
            - 如果BBST的左右子树高度相等，插入完成
            - 如果BBST的左子树的高度小于右子树，插入完成

- 删除
	- 将AVL树节点向下旋转，直至转为一个叶子节点，删除叶子节点即可

- 查找
	- AVL树节点的查找和二叉搜索树一致，不赘述

### 红黑树(Red Black Tree)
- 在某些场合下，AVL的过度的旋转追求平衡会影响性能，树结构的主要目的在于提高增删以及查找的性能，红黑树是平衡性能和时间复杂度的解决方案。红黑树并不追求绝对的平衡，它只要求部分树结构达到平衡要求，降低了对旋转的要求，从而提高了性能。由于红黑树的设计，任何不平衡都会在三次旋转之内解决。AVL是最先发明的自平衡二叉搜索树，在演化过程中，产生了红黑树这样的结构。

- 红黑树的特征:
	1. 节点是红色或黑色
	2. 根节点是黑色
	3. 每个叶节点（NIL节点，空节点）是黑色的
	4. 每个红色节点的两个子节点都是黑色（从每个叶子到根的所有路径上不能有两个连续的红色节点）
	5. 从任一节点到其每个叶子的所有路径都包含相同数目的黑色节点

- 红黑树的插入
	- 插入的节点必为红色
		- 根据性质5，根节点到叶子节点的路径上黑节点的数量是相同的，如果插入节点为黑色，则会违背该性质
	- 执行插入，分为以下情况:
		- 插入到一颗空树
			- 节点插入的树为空树，则可以直接以插入节点为根节点，但是要将插入节点重新改为黑色，满足性质2
		- 插入的父节点为黑色
			- 节点插入的父节点为黑色，满足所有条件，无需调整
		- 插入的父节点为红色。父节点为红色，根据性质2和性质4，则父节点必然还有父节点。这样又要分作以下情况:
			- 父节点和叔父节点均为红色，无法满足性质4，需要将父节点与叔父节点均设为黑色，祖父节点设为红色
				- 此时，如果祖父节点为根节点则与性质2相违背
				- 祖父节点不为根节点，由于其颜色发生了变化所以需要将其作为一个全新的节点向上递归，调整颜色
			- 如果父节点为红色，而叔父节点为黑色或者不存在
				- 父节点为左子节点
                    - 插入的节点为父节点的左子节点，此时无法满足性质4
                    	- 此时，插入的节点与其父节点构成了左左结构，需要对其父节点进行右旋操作
                    	- 父节点替换祖父节点的位置，祖父节点作为父节点的右子节点，依次将父节点改为黑色，祖父节点改为红色，则满足红黑树的所有性质。
                    - 插入的节点为父节点的右子节点，此时无法满足性质4
                    	- 此时，插入节点与其父节点构成了左右结构，红黑树需要将这个新插入节点左旋转为父节点的左子节点，再参考上一步骤进行操作
                - 父节点为右子节点
                	- 插入的节点为父节点的左子节点
                		- 此时，插入节点与父节点构成右左结构，先转为右右结构，再参照下一部的步骤进行操作
                	- 插入的节点为父节点的右子节点
                    	- 此时，插入节点与父节点构成右右结构，对父节点进行左旋操作
                    	- 父节点为祖父节点，祖父节点为父节点的左自己诶单，一次将福界定啊改为黑色，祖父节点改为红色，则满足红黑树的所有性质

- 红黑树的删除，参照二叉搜索树，删除之后，根据节点颜色进行修正

- 红黑树平衡修正：对红-黑树进行添加或删除后，可能会破坏其平衡性，进而需要进行修正。参照AVL树的插入部分，分为四种情况进行分别旋转，旋转之后需要自底向上重新着色
	- 左左结构
	- 左右结构
	- 右左结构
	- 右右结构